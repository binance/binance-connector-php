<?php

/**
 * MarketDataApiTest
 * PHP version 8.1.
 *
 * @category Class
 *
 * @author   OpenAPI Generator team
 *
 * @see     https://openapi-generator.tech
 */

/**
 * Binance Derivatives Trading Options REST API.
 *
 * OpenAPI Specification for the Binance Derivatives Trading Options REST API
 *
 * The version of the OpenAPI document: 1.0.0
 * Generated by: https://openapi-generator.tech
 * Generator version: 7.12.0
 */

/**
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Please update the test case below to test the endpoint.
 */

namespace Binance\Client\DerivativesTradingOptions\Test\Api;

use Binance\Client\DerivativesTradingOptions\Api\MarketDataApi;
use Binance\Common\Configuration\ClientConfiguration;
use Binance\Common\Configuration\SignatureConfiguration;
use Binance\Common\HttpClient;
use GuzzleHttp\Psr7\Utils;
use PHPUnit\Framework\TestCase;
use Psr\Http\Message\ResponseInterface;

/**
 * MarketDataApiTest Class Doc Comment.
 *
 * @category Class
 *
 * @author   OpenAPI Generator team
 *
 * @see     https://openapi-generator.tech
 *
 * @internal
 *
 * @coversNothing
 */
class MarketDataApiTest extends TestCase
{
    public function getApiMock(&$request)
    {
        $clientMock = $this->createMock(HttpClient::class);
        $signatureConfig = new SignatureConfiguration();
        $signatureConfig->setApiKey('apiKey');
        $signatureConfig->setSecretKey('secretKey');
        $clientConfig = new ClientConfiguration();
        $clientConfig->setUrl('http://localhost:8080');
        $clientConfig->setSignatureConfiguration($signatureConfig);
        $responseMock = $this->createMock(ResponseInterface::class);

        $responseMock->expects($this->any())
            ->method('getStatusCode')
            ->willReturn(200)
        ;

        $responseMock->expects($this->any())
            ->method('getBody')
            ->willReturn(Utils::streamFor('{}'))
        ;

        $clientMock->expects($this->once())
            ->method('send')
            ->will($this->returnCallback(function ($actualRequest) use (&$request, $responseMock) {
                $request = $actualRequest;

                return $responseMock;
            }))
        ;

        $apiMock = $this->getMockBuilder(MarketDataApi::class)
            ->setConstructorArgs([$clientConfig, $clientMock])
            ->onlyMethods(['getTimestamp'])
            ->getMock()
        ;

        $apiMock->method('getTimestamp')->willReturn('1736393892000');

        return $apiMock;
    }

    /**
     * Test case for checkServerTime.
     *
     * Check Server Time.
     */
    public function testCheckServerTime()
    {
        $response = $this->getApiMock($request)->checkServerTime();

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/time', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for exchangeInformation.
     *
     * Exchange Information.
     */
    public function testExchangeInformation()
    {
        $response = $this->getApiMock($request)->exchangeInformation();

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/exchangeInfo', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for historicalExerciseRecords.
     *
     * Historical Exercise Records.
     */
    public function testHistoricalExerciseRecords()
    {
        $underlying = '';
        $startTime = 1623319461670;
        $endTime = 1641782889000;
        $limit = 100;
        $response = $this->getApiMock($request)->historicalExerciseRecords($underlying, $startTime, $endTime, $limit);

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/exerciseHistory', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for klineCandlestickData.
     *
     * Kline/Candlestick Data.
     */
    public function testKlineCandlestickData()
    {
        $symbol = '';
        $interval = '';
        $startTime = 1623319461670;
        $endTime = 1641782889000;
        $limit = 100;
        $response = $this->getApiMock($request)->klineCandlestickData($symbol, $interval, $startTime, $endTime, $limit);

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/klines', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for oldTradesLookup.
     *
     * Old Trades Lookup (MARKET_DATA).
     */
    public function testOldTradesLookup()
    {
        $symbol = '';
        $fromId = 1;
        $limit = 100;
        $response = $this->getApiMock($request)->oldTradesLookup($symbol, $fromId, $limit);

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/historicalTrades', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for openInterest.
     *
     * Open Interest.
     */
    public function testOpenInterest()
    {
        $underlyingAsset = '';
        $expiration = '';
        $response = $this->getApiMock($request)->openInterest($underlyingAsset, $expiration);

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/openInterest', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for optionMarkPrice.
     *
     * Option Mark Price.
     */
    public function testOptionMarkPrice()
    {
        $symbol = '';
        $response = $this->getApiMock($request)->optionMarkPrice($symbol);

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/mark', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for orderBook.
     *
     * Order Book.
     */
    public function testOrderBook()
    {
        $symbol = '';
        $limit = 100;
        $response = $this->getApiMock($request)->orderBook($symbol, $limit);

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/depth', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for recentBlockTradesList.
     *
     * Recent Block Trades List.
     */
    public function testRecentBlockTradesList()
    {
        $symbol = '';
        $limit = 100;
        $response = $this->getApiMock($request)->recentBlockTradesList($symbol, $limit);

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/blockTrades', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for recentTradesList.
     *
     * Recent Trades List.
     */
    public function testRecentTradesList()
    {
        $symbol = '';
        $limit = 100;
        $response = $this->getApiMock($request)->recentTradesList($symbol, $limit);

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/trades', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for symbolPriceTicker.
     *
     * Symbol Price Ticker.
     */
    public function testSymbolPriceTicker()
    {
        $underlying = '';
        $response = $this->getApiMock($request)->symbolPriceTicker($underlying);

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/index', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for testConnectivity.
     *
     * Test Connectivity.
     */
    public function testTestConnectivity()
    {
        $this->getApiMock($request)->testConnectivity();

        parse_str($request->getUri(), $queryMap);

        self::assertEquals('/eapi/v1/ping', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }

    /**
     * Test case for ticker24hrPriceChangeStatistics.
     *
     * 24hr Ticker Price Change Statistics.
     */
    public function testTicker24hrPriceChangeStatistics()
    {
        $symbol = '';
        $response = $this->getApiMock($request)->ticker24hrPriceChangeStatistics($symbol);

        parse_str($request->getUri(), $queryMap);

        self::assertEquals(200, $response->getStatusCode());
        self::assertEquals('/eapi/v1/ticker', $request->getUri()->getPath());
        self::assertTrue(!isset($queryMap['signature']));
    }
}
